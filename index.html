<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bản đồ mưa (nhúng vrain.vn)</title>
  <style>
    :root{
      --bg:#f7f7f8;
      --primary:#0077b6;
      --accent:#00b4d8;
      --text:#0b1320;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:var(--text);background:var(--bg)}
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 16px;
      background:linear-gradient(90deg,var(--card),#fff);
      box-shadow:0 2px 6px rgba(2,6,23,0.06);
      position:sticky;
      top:0;
      z-index:10;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }
    h1{font-size:16px;margin:0}
    .actions{display:flex;gap:8px;align-items:center}
    .btn{
      padding:8px 12px;border-radius:8px;border:0;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;
      text-decoration:none;display:inline-flex;align-items:center;gap:8px;
    }
    .btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(0,119,182,0.12)}
    .wrap{
      height: calc(100vh - 72px);
      padding:12px;
    }
    .frame-card{
      height:100%;
      background:var(--card);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 6px 20px rgba(2,6,23,0.06);
      position:relative;
      border:1px solid rgba(10,10,10,0.03);
    }
    .responsive-iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
    .overlay{
      position:absolute;left:0;right:0;top:0;bottom:0;
      display:flex;align-items:center;justify-content:center;flex-direction:column;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.2));
      backdrop-filter: blur(2px);
      transition:opacity .25s ease;
    }
    .hidden{display:none}
    .spinner{
      width:48px;height:48px;border-radius:50%;border:5px solid rgba(0,0,0,0.08);border-top-color:var(--primary);animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .message{max-width:720px;padding:12px;text-align:center;color:#123;line-height:1.4}
    .hint-link{color:var(--primary);text-decoration:underline;cursor:pointer}
    .note{font-size:13px;color:#666;margin-top:6px}
    @media (max-width:520px){
      .topbar{padding:10px}
      .brand h1{font-size:14px}
      .wrap{padding:8px;height: calc(100vh - 64px)}
    }
  </style>
</head>
<body>
  <div class="topbar" role="navigation" aria-label="Topbar">
    <div class="brand">
      <div class="logo">M</div>
      <div>
        <h1>Bản đồ mưa — Nhúng vrain.vn</h1>
        <div class="note">Nguồn: vrain.vn (windy)</div>
      </div>
    </div>

    <div class="actions">
      <a id="openBtn" class="btn" target="_blank" rel="noopener noreferrer" href="https://www.vrain.vn/34/overview?public_map=windy">
        Mở bản đồ gốc
      </a>
      <button id="reloadBtn" class="btn ghost" title="Tải lại iframe">Tải lại</button>
    </div>
  </div>

  <div class="wrap">
    <div class="frame-card" id="frameCard">
      <div id="overlay" class="overlay">
        <div class="spinner" aria-hidden="true"></div>
        <div class="message">
          Đang tải bản đồ...<div class="note">Nếu trang không hiển thị sau vài giây, có thể trang gốc không cho phép nhúng (X-Frame-Options). Bạn có thể mở bản đồ gốc bằng nút <strong>Mở bản đồ gốc</strong>.</div>
        </div>
      </div>

      <iframe id="rainFrame"
        class="responsive-iframe"
        src="https://www.vrain.vn/34/overview?public_map=windy"
        title="Bản đồ mưa - vrain.vn"
        allowfullscreen
        sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
      ></iframe>
    </div>
  </div>

  <script>
    (function(){
      const iframe = document.getElementById('rainFrame');
      const overlay = document.getElementById('overlay');
      const openBtn = document.getElementById('openBtn');
      const reloadBtn = document.getElementById('reloadBtn');

      let loaded = false;
      // Một số trang chặn iframe; onload có thể không chạy hoặc chạy nhanh tùy trình duyệt.
      iframe.addEventListener('load', () => {
        // Nếu iframe contentWindow bị null do chặn, vẫn có thể nhận event load.
        loaded = true;
        overlay.style.display = 'none';
      });

      // Nếu sau 6 giây vẫn chưa load thì hiển thị cảnh báo/nút mở trang gốc
      const checkTimeout = setTimeout(() => {
        if (!loaded) {
          overlay.innerHTML = `
            <div class="message">
              Không thể hiển thị bản đồ trong iframe — trang có thể chặn nhúng.<br>
              <div style="margin-top:12px">
                <a href="${iframe.src}" target="_blank" rel="noopener noreferrer" class="btn">Mở bản đồ gốc</a>
                <button id="tryAgain" class="btn ghost" style="margin-left:8px">Thử lại nhúng</button>
              </div>
              <div class="note">Nếu bạn cần nhúng thực sự, có thể dùng proxy hoặc API chính chủ của dịch vụ (nếu có).</div>
            </div>
          `;
          const tryBtn = document.getElementById('tryAgain');
          tryBtn && tryBtn.addEventListener('click', () => {
            overlay.innerHTML = '<div class=\"spinner\" style=\"margin-bottom:12px\"></div><div class=\"message\">Đang thử tải lại...</div>';
            iframe.src = iframe.src; // reload
            setTimeout(()=>{ if(!loaded) overlay.style.display='flex'; }, 300);
          });
        }
      }, 6000);

      // nút reload
      reloadBtn.addEventListener('click', () => {
        overlay.style.display = 'flex';
        overlay.innerHTML = '<div class="spinner" aria-hidden="true"></div><div class="message">Đang tải lại...</div>';
        loaded = false;
        iframe.src = iframe.src;
      });

    })();
  </script>
</body>
</html>
